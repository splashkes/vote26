# Art Battle Host Onboarding SPA - nginx configuration
# Add this to your existing nginx config

# Host SPA - Route /host/ to CDN
location /host/ {
    # Proxy to DigitalOcean Spaces CDN
    proxy_pass https://artb.tor1.cdn.digitaloceanspaces.com/host/;

    # Headers for CDN
    proxy_set_header Host artb.tor1.cdn.digitaloceanspaces.com;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header X-Forwarded-Proto $scheme;

    # SSL settings for upstream
    proxy_ssl_server_name on;
    proxy_ssl_protocols TLSv1.2 TLSv1.3;

    # Handle SPA routing - serve index.html for all routes
    proxy_intercept_errors on;
    error_page 404 403 = @host_fallback;

    # Cache settings
    proxy_cache_valid 200 1m;
    proxy_cache_valid 404 1m;

    # CORS headers
    add_header Access-Control-Allow-Origin "*" always;
    add_header Access-Control-Allow-Methods "GET, HEAD, OPTIONS" always;
}

# Fallback for SPA client-side routing
location @host_fallback {
    proxy_pass https://artb.tor1.cdn.digitaloceanspaces.com/host/index.html;
    proxy_set_header Host artb.tor1.cdn.digitaloceanspaces.com;
    proxy_ssl_server_name on;
    proxy_ssl_protocols TLSv1.2 TLSv1.3;

    add_header Access-Control-Allow-Origin "*" always;
    add_header Access-Control-Allow-Methods "GET, HEAD, OPTIONS" always;
}

# Direct access to /host with trailing slash redirect
location = /host {
    return 301 /host/;
}
